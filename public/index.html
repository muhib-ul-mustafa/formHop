<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Bootstrap demo</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
          <link rel="stylesheet" href="style.css">
      </head>
      
<body>
    <form id="myForm" action="https://form-hop.vercel.app/submit" method="post">
        <div class="container">
            <h1 class="text-center mb-3">Registration Form</h1>
            <div class="row">
              <div class="col-md-6 col-lg-6 col-sm-12">
                <div class="form-floating mb-3">
                  <input type="text" class="form-control formCourse" id="courseInput" placeholder="" name="Course" >
                  <label for="candidateName">Course:</label>
                </div>
              </div>
              <div class="col-md-6 col-lg-6 col-sm-12 skeme">
                <div class="form-floating mb-3">
                  <input type="text" class="form-control" id="Skeme" placeholder="" onchange="courseChange()" name="Skeme">
                  <label for="Skeme">Skeme:</label>
                </div>
              </div>
            </div>
            <div class="infoCnic border border-dark mb-3">
              <p class="fs-md-1 fs-lg-1 fs-sm-4">Applicant Information(As Per CNIC)</p>
              <div class="row">
                <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="candidateName" placeholder="" name="CandidateName">
                    <label for="candidateName">Candidate Name:</label>
                  </div>
                </div>
                <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="fatherName" placeholder="" name="FatherName">
                    <label for="fatherName">Father Name:</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="PermanentAddress" placeholder="" name="PermanentAddress">
                    <label for="PermanentAddress">Permanent Address:</label>
                  </div>
                </div>
                <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="endingDate" placeholder="" name="Email"
                      >
                    <label for="endingDate">Email:</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                    <input type="number" class="form-control" id="candidateCNICNumber" placeholder="" name="CandidateCNICNumber" oninput="limitInputLength(this, 13)">
                    <label for="candidateCNICNumber">Candidate CNIC Number:</label>
                  </div>
                </div>
                <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                    <input type="date" class="form-control" id="DateOfBirth" placeholder="" name="DateOfBirth">
                    <label for="DateOfBirth">Date of Birth:</label>
                  </div>
                </div>
              </div>
      
              <div class="row">
                <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                    <input type="number" class="form-control" id="candidateCellNumber" placeholder="" name="CandidateCellNumber" oninput="limitInputLength(this, 11)">
                    <label for="candidateCellNumber">Candidate Cell Number:</label>
                  </div>
                </div>
                <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                    <input type="number" class="form-control" id="fatherCellNumber" placeholder="" name="FatherCellNumber" oninput="limitInputLength(this, 11)">
                    <label for="fatherCellNumber">Father Cell Number:</label>
                  </div>
                </div>
              </div>
      
              <div class="row">
                <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                    <select class="form-select" id="qualification" aria-label="Qualification" name="Qualification">
                      <option value="" selected>Choose a qualification</option>
                      <option value="Matric">Matric</option>
                      <option value="Intermediate">Intermediate</option>
                      <option value="Bachelors">Bachelors Degree</option>
                      <option value="Masters">Masters / MPhill</option>
                      <option value="PhD">PhD</option>
                    </select>
                    <label for="qualification">Qualification:</label>
                  </div>
                </div>
      
                <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                    <select class="form-select" id="gender" aria-label="Gender" name="Gender">
                      <option value="" selected>Choose a gender</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                      <option value="genderX">Gender X</option>
                    </select>
                    <label for="gender">Gender:</label>
                  </div>
                </div>
              </div>
            </div>
                  
            <div class="row">
              <div class="form-group col-md-6 col-lg-6 col-sm-12">
                <div>
                  <input type="text" class="form-control" id="applicationID" placeholder="Application ID:" name="ApplicationID">
                </div>
              </div>
      
              <div class="col-md-6 col-lg-6 col-sm-12">
                <div class="form-floating mb-3">
                  <input type="date" class="form-control" id="registrationDate" placeholder="" name="RegistrationDate" >
                  <label for="registrationDate">Registration Date:</label>
                </div>
              </div>
            </div>
      
            <div class="row">
              <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                      <input type="date" class="form-control" id="startingDate" placeholder="" name="StartingDate">
                      <label for="startingDate">Starting Date:</label>
                  </div>
              </div>
              <div class="col-md-6 col-lg-6 col-sm-12">
                  <div class="form-floating mb-3">
                      <input type="date" class="form-control" id="endingDate" placeholder="" onchange="calculateDuration()" name="EndingDate">
                      <label for="endingDate">Ending Date:</label>
                  </div>
              </div>
          </div>
          
          <div class="row">
              <!-- <div class="col-md-6 col-lg-6 col-sm-12 mb-3">
                  <p id="durationHeading">Duration</p>
                  <input type="text" class="form-control" id="duration" placeholder="Duration" name="Duration">
              </div> -->
              <div class="col-md-12 col-lg-12 col-sm-12">
                  <div class="form-floating mb-3">
                      <input type="number" class="form-control" id="classDaysaWeek" placeholder="" name="ClassDaysAWeek">
                      <label for="classDaysaWeek">Class Days a Week:</label>
                  </div>
              </div>
          </div>
            <hr class="mb-3">
            <!-- <h4 class="fs-md-1 fs-lg-1 fs-sm-4 text-dark font-weight-bold">For Office Use Only</h4> -->
      
            <div class="row">
              <div class="col-md-6 col-lg-6 col-sm-12">
                <div class="form-floating mb-3">
                  <input type="number" class="form-control" id="totalFees" placeholder="" name="TotalFees" onchange="calculateFeesRemaining()">
                  <label for="TotalFees">Total Fees:</label>
                </div>
              </div>
              <div class="col-md-6 col-lg-6 col-sm-12">
                <div class="form-floating mb-3">
                  <input type="text" class="form-control" id="paymentTerms" placeholder="" name="PaymentTerms">
                  <label for="paymentTerms">Payment Terms:</label>
                </div>
              </div>
            </div>
      
            <div class="row">
              <div class="col-md-6 col-lg-6 col-sm-12">
                <div class="form-floating mb-3">
                  <input type="number" class="form-control" id="feesReceived" placeholder="" name="FeesReceived" onchange="calculateFeesRemaining()">
                  <label for="feesReceived">Fees Received:</label>
                </div>
              </div>
              <div class="col-md-6 col-lg-6 col-sm-12">
                <div class="form-floating mb-3">
                  <input type="number" class="form-control" id="feesInstallments" placeholder="" name="NumberOfInstallments" value="0">
                  <label for="feesInstallment">Number of Installements:</label>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 col-lg-6 col-sm-12">
                <div class="form-floating mb-3">
                  <input type="number" class="form-control" id="feesRemaining" placeholder="" name="FeesRemaining" value="0">
                  <label for="feesRemaining">Fees Remaining:</label>
                </div>
              </div>
              <div class="col-md-6 col-lg-6 col-sm-12">
                <div class="form-floating mb-3">
                  <input type="text" class="form-control" id="remarks" placeholder="" name="Remarks">
                  <label for="remarks">Remarks:</label>
                </div>
              </div>
            </div>
            <div class="col-md-5 col-lg-6 col-sm-12">
              <button class="" type="submit">Save Data</button>
            </div>
          </div>
    </form>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script>
    function generateRollNumber(courseValue, skemeValue) {
      const key = `${courseValue}_${skemeValue}`;
      let rollNumber = localStorage.getItem(key) || 0;
      rollNumber++;
      localStorage.setItem(key, rollNumber);
      return `${courseValue}_${skemeValue}_${rollNumber}`;
    }

    const registrationCounts = {};
    let previousCourse = '';

    function courseChange() {
      const courseValue = document.getElementById("courseInput").value;
      const skemeValue = document.getElementById("Skeme").value;

      if (courseValue !== previousCourse) {
        registrationCounts[skemeValue] = 1;
      } else {
        if (!registrationCounts[skemeValue]) {
          registrationCounts[skemeValue] = 1;
        } else {
          registrationCounts[skemeValue]++;
        }
      }

      const roleNumber = registrationCounts[skemeValue];
      const applicationIDValue = generateRollNumber(courseValue, skemeValue);

      document.getElementById("applicationID").value = applicationIDValue;

      previousCourse = courseValue;
    }
    function calculateFeesRemaining() {
      // Get values from input fields
      const totalFees = parseFloat(document.getElementById('totalFees').value) || 0;
      const feesReceived = parseFloat(document.getElementById('feesReceived').value) || 0;
      const feesInstallments = document.getElementById("feesInstallments");
      const zero = 0;

      // Calculate fees remaining
      const remaining = totalFees - feesReceived;

      // Update the Fees Remaining field
      document.getElementById('feesRemaining').value = remaining.toFixed(2);

      // Check if fees remaining is zero and update the number of installments
      if (remaining === 0) {
        feesInstallments.value = zero;
      }
    }
    function limitInputLength(element, maxLength) {
    let inputValue = element.value;
    if (inputValue.length > maxLength) {
      element.value = inputValue.slice(0, maxLength);
    }
  }
      const express = require('express');
const bodyParser = require('body-parser');
const mongoose = require('mongoose');
const path = require('path');
const nodemailer = require('nodemailer');
const validator = require("validator")

const app = express();

app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());
app.use(express.static(path.join(__dirname, 'public')));
mongoose.connect('mongodb+srv://muhibawan:muhibraza@houseofprofessionals.q10d5wg.mongodb.net/?retryWrites=true&w=majority');

const db = mongoose.connection;
db.on('error', console.error.bind(console, 'connection error:'));
db.once('open', () => {
  console.log('Connected to MongoDB server');
});

// Schema and User Model declaration
const userSchema = new mongoose.Schema({
  Course: String,
  Skeme: String,
  CandidateName: String,
  FatherName: String,
  PermanentAddress: String,
  Email: {
    type:String,
    required:true,
    validate: {
      validator: (value) => validator.isEmail(value),
      message: (props) => `${props.value} is not a valid email address!`,
    },
    trim:true,
    lowercase:true,
    unique:true,
  },  CandidateCNICNumber:{
    type:Number,
    unique:true,
    maxlength:13,
    minlength:13,
    required:true,
  },
  DateOfBirth: String,
  CandidateCellNumber:{
    type:  Number,
    maxlength: 11,
    minlength:11,
    required:true,
  },
  FatherCellNumber: {
    type:  Number,
    maxlength: 11,
    minlength:11,
    required:true,
  },
  Qualification: String,
  Gender: String,
  ApplicationID: String,
  PaymentSlipNumber: String,
  RegistrationDate: String,
  StartingDate: String,
  EndingDate: String,
  Duration: String,
  ClassDaysAWeek: String,
  TotalFees: String,
  PaymentTerms: String,
  FeesReceived: String,
  NumberOfInstallments: String,
  FeesRemaining: String,
  Remarks: String,
});

const User = mongoose.model("web", userSchema);

const transporter = nodemailer.createTransport({
  service: 'gmail',
  auth: {
    user: 'muhibulmustafaawan@gmail.com',
    pass: 'kpnt mahr gswh oasq',
  },
});

// Serve index.html by default
app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname, 'public', 'index.html'));
});

app.post('/submit', (req, res) => {
  const {
    Course,
    Skeme,
    CandidateName,
    FatherName,
    PermanentAddress,
    Email,
    CandidateCNICNumber,
    DateOfBirth,
    CandidateCellNumber,
    FatherCellNumber,
    Qualification,
    Gender,
    ApplicationID,
    PaymentSlipNumber,
    RegistrationDate,
    StartingDate,
    EndingDate,
    Duration,
    ClassDaysAWeek,
    TotalFees,
    PaymentTerms,
    FeesReceived,
    NumberOfInstallments,
    FeesRemaining,
    Remarks,
  } = req.body;

  const data = {
    Course,
    Skeme,
    CandidateName,
    FatherName,
    PermanentAddress,
    Email,
    CandidateCNICNumber,
    DateOfBirth,
    CandidateCellNumber,
    FatherCellNumber,
    Qualification,
    Gender,
    ApplicationID,
    PaymentSlipNumber,
    RegistrationDate,
    StartingDate,
    EndingDate,
    Duration,
    ClassDaysAWeek,
    TotalFees,
    PaymentTerms,
    FeesReceived,
    NumberOfInstallments,
    FeesRemaining,
    Remarks,
  };

  const newUser = new User(data);

  newUser.save()
    .then(() => {
      const mailOptions = {
        from: 'muhibulmustafaawan@gmail.com',
        to: Email,
        subject: ' Successful Registration at House Of Professionals',
        html: `
          <p>Dear ${CandidateName},</p>
          <p><b>Congratulations!</b> We are delighted to inform you that your registration at House Of Professionals has been successfully completed. Welcome to our academic community!<br>
            Your commitment to pursuing higher education is commendable, and we believe that your time with us will be both enriching and rewarding. As a registered student, you now have access to a wide array of resources, outstanding faculty, and a supportive environment that will aid you in achieving your academic and personal goals.<br>
          To help you get started, here are some essential details:<br>
          <b>Orientation Program:</b>
          We look forward to hosting an orientation program that will provide you with vital information about the institute, academic expectations, campus facilities, and more. Your attendance is encouraged to ensure a smooth transition into your academic journey.<br>
          <b>Application ID:</b>
Your unique Application ID is ${ApplicationID}. Please make a note of it, as it will serve as an important reference during your time with us.<br>
<b>Class Schedule:</b>
Access your class schedule for the upcoming semester through our user-friendly student portal. If you have any concerns about your schedule, our registrar's office is available to assist you.<br>
         We are excited to have you as part of House Of Professionals, and we are committed to supporting you throughout your educational journey. Should you have any questions or need assistance, feel free to reach out to our student services team.<br>
         Once again, congratulations on your successful registration! Wishing you a fulfilling and successful academic experience.</p>
         <p>Best Regards,<br>
         Management of House Of Professionals.
         </p>
        `,
      };

      transporter.sendMail(mailOptions, (error, info) => {
        if (error) {
          return res.status(500).send('Error sending email: ' + error.message);
        }
        console.log('Email sent:', info.response);
        res.send('User saved successfully! Email sent successfully! <br> <a href="/" style="color: black; text-decoration: none; font-weight: bold; margin-top:20px;">Back to Home</a>');
      });
    })
    .catch((err) => {
      console.error(err);
      res.status(500).send('Server error');
    });
});
console.log("muhib");
const port = process.env.PORT || https://form-hop.vercel.app/;
app.listen(port, () => console.log(`Server running on port ${port}`));

  </script>
  </script>
</body>
</html>
